"use strict";var _grids=_grids||{},$api=$api||{},$toast=$toast||{},_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function showConfirmMessage(t){var e=t.data("trigger-confirm"),a=t.data("confirmation-msg")||"Are you sure?";return!e||confirm(a)}function callDoActionQuery(t,e,a=!1){let n=new URLSearchParams(location.search);n.forEach(function(t,e){a?n.delete(e):"page"==e&&n.delete(e)}),$.each(e,function(t,e){e.value?n.set(e.name,e.value):n.delete(e.name)});let i=""==n.toString()?"":"?"+n.toString(),o=new URL(i,t);window.location.replace(o.toString())}function downloadFilePath(t){(_.isNil(t)||_.isEmpty(t))&&$toast.showError("Notification","File not found!"),$.fileDownload(t).done(function(){$toast.showSuccess("Notification","Download is successfull")}).fail(function(){$toast.showError("Notification","Download is fail")})}!function(t){if(void 0===t)throw new Error("Requires jQuery");t.fn.serializeObject=function(){var e={},a=this.serializeArray();return t.each(a,function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e};var e={renderTitle:function(e){return t("<b />",{class:"mr-auto toast-title"}).text(e)},renderHeader:function(e,a,n){var i=t("<i />",{class:"bi "+n}),o=t("<span />",{class:"rounded mr-2 mb-0 h5 text-"+a}).append(i),r=t("<div />",{class:"toast-header"}),s=t("<button />",{type:"button",class:"ml-2 mb-1 close","data-dismiss":"toast","aria-label":"Close"}).html('<span aria-hidden="true">&times;</span>');return r.append(o).append(this.renderTitle(e)).append(s),r},renderBody:function(e){var a=t("<div />",{class:"toast-body"});return a.html(e),a},render:function(e,a,n,i){var o=t("<div />",{class:"toast",role:"alert","aria-live":"assertive","aria-atomic":"true","data-delay":"5000"});return o.append(this.renderHeader(e,n,i)).append(this.renderBody(a)),t("#popupToast").html(o),o},showSuccess:function(t,e){return this.render(t,e,"success","bi-check-circle-fill").toast("show")},showError:function(t,e){return this.render(t,e,"danger","bi-x-circle-fill").toast("show")}};$toast=e,$api={_callApi:function(a,n,i,o){let r=_.get(o,"contentType",!1),s=_.get(o,"targetLoading",null),l=null,c=null;s&&(l=t(s).data("loading"),c=t(s).html()),t.ajax({method:a,url:n,data:i,dataType:"json",contentType:r,processData:!1,beforeSend:function(){_.has(o,"beforeSend")&&o.beforeSend.call(this),s&&t(s).attr("disabled","disabled").addClass("disabled").html('<i class="fa fa-spinner fa-spin"></i>&nbsp;'+l)},complete:function(){_.has(o,"onComplete")&&o.onComplete.call(this),s&&t(s).html(c).removeAttr("disabled").removeClass("disabled")},success:function(a){_grids.formUtils.clearFormValidationErrors(),_.has(o,"onSuccess")?o.onSuccess.call(this,a):(_.has(o,"pjaxContainer")&&!_.isNil(o.pjaxContainer)&&t.pjax.reload({container:o.pjaxContainer}),void 0!==e&&_.get(a,"success")&&e.showSuccess("Message","<p>"+_.get(a,"message")+"</p>"))},error:function(t){if(_.has(o,"onError"))o.onError.call(this,t);else if(void 0!==e){let a=_grids.formUtils.genarateValidationErrors(t.responseJSON);e.showError("Message","<ul>"+a+"</ul>")}else alert("An error occurred")}})},get:function(t,e,a){if(""!=t){e=e||{};var n=new URLSearchParams;for(const[t,a]of Object.entries(e))n.append(t,a);this._callApi("GET",t+"?"+n.toString(),null,a)}},post:function(t,e,a){""!=t&&this._callApi("POST",t,e,a)},put:function(t,e,a){""!=t&&(a=Object.assign({contentType:"application/json"},a),this._callApi("PUT",t,e,a))},delete:function(t,e,a){""!=t&&(a=Object.assign({contentType:"application/json"},a),this._callApi("DELETE",t,e,a))}},_grids.utils={handleAjaxRequest:function(e,a,n){a=a||"click",e.length<1||e.each(function(e,i){var o=(i=t(i)).data("pjax-target");i.data("refresh-page");let r=i.data("form-id")?t("#"+i.data("form-id")):null;var s=i.is("form"),l=i.data("method")||"POST",c=i.attr("href")||i.data("action"),d=i.data("value");if(_.isObject(d)&&(d=JSON.stringify(d)),s||r){let t=s?i:r;l=t.attr("method"),c=t.attr("action"),d=JSON.stringify(t.serializeObject())}i.on(a,function(t){if(t.preventDefault(),showConfirmMessage(i)){if(s||r){let t=s?i:r;d=JSON.stringify(t.serializeObject())}$api._callApi(l,c,d,_.merge({contentType:"application/json",targetLoading:i,pjaxContainer:o},n))}})})},tableLinks:function(e){e?t(e.element).each(function(a,n){var i=t(n),o=i.data("url");i.css({cursor:"pointer"}),i.click(function(t){setTimeout(function(){window.location=o},e.navigationDelay||100)})}):console.warn("No options defined.")},_getTableProps:function(e){var a={thead:{},tbody:{},tfoot:{},border:0};return e.find("thead tr:first-child > *").each(function(e){a.thead[e]=t(this).outerWidth()+a.border}),e.find("tfoot tr:first-child > *").each(function(e){a.tfoot[e]=t(this).outerWidth()+a.border}),e.find("tbody tr:first-child > *").each(function(e){a.tbody[e]=t(this).outerWidth()+a.border}),a},getProgressButton(e,a){if(e){let n=t(e).data("loading"),i=t(e).data("text");a?t(e).attr("disabled","disabled").html('<i class="fa fa-spinner fa-spin"></i>&nbsp;'+n):t(e).html(i).removeAttr("disabled")}},filterMultiSelect:function(e,a,n){e.length<1||e.each(function(e,i){t(i).multiselect(_.merge({nonSelectedText:_.get(a,"nonSelectedText"),selectAllText:_.get(a,"selectAllText"),includeSelectAllOption:!0,numberDisplayed:_.get(a,"numberDisplay"),onInitialized:function(t,e){_.has(a,"onInitialized")&&a.onInitialized.call(t,e)}},n)),t(i).off("change").on("change",function(){let e=[{name:t(i).attr("name"),value:t(i).val().join(",")}];callDoActionQuery(_.get(a,"routeLink"),e)})})},initMultiSelect:function(e,a,n){e.length<1||e.each(function(e,i){t(i).multiselect(_.merge({nonSelectedText:_.get(a,"nonSelectedText"),selectAllText:_.get(a,"selectAllText"),includeSelectAllOption:!0,numberDisplayed:_.get(a,"numberDisplay"),onInitialized:function(t,e){_.has(a,"onInitialized")&&a.onInitialized.call(t,e)}},n))})}};var a=function(){function e(a){_classCallCheck(this,e);var n={id:"#some-grid",filterForm:void 0,searchForm:void 0,pagerDropdown:void 0,sortLinks:"data-sort",dateRangeSelector:".date-range",pjax:{pjaxOptions:{},afterPjax:function(t){}}};this.opts=t.extend({},n,a||{})}return _createClass(e,[{key:"setupPjax",value:function(e,a,i,o){var r=this;t.pjax.defaults.timeout=o.timeout||3e3,t(document).pjax(a,e,o),t(document).on("ready pjax:end",function(e){i(t(e.target)),n(r)})}},{key:"stickyHeaderTable",value:function(){let e=t(this.opts.id);var a=_grids.utils._getTableProps(e);let n=e.parent();e.find("thead tr:first-child th").each(function(e,n){t(n).css("min-width",a.thead[e]+"px")}),n.closest(".table-wrapper").length||n.wrap('<div class="table-wrapper"></div>');let i=e.clone().wrap('<div class="table-responsive sticky-table sticky-top"></div>');i.find("tbody").remove(),i.find("thead tr").length>1&&i.find("thead tr:last-child").remove(),i.closest(".sticky-table").insertBefore(n),e.addClass("content-table"),n.scroll(function(){i.closest(".sticky-table").scrollLeft(n.scrollLeft())}),t(window).resize(function(){var a=_grids.utils._getTableProps(e);e.find("thead tr:first-child th").each(function(e,n){t(n).css("min-width",a.thead[e]+"px")}),i.find("thead tr:first-child th").each(function(e,n){t(n).css("min-width",a.thead[e]+"px")})})}},{key:"bindPjax",value:function(){this.setupPjax(this.opts.id,"a[data-trigger-pjax=1]",this.opts.pjax.afterPjax,this.opts.pjax.pjaxOptions),n(this),this.stickyHeaderTable()}},{key:"filter",value:function(){let e=t(this.opts.filterForm.btnName);var a=t(this.opts.filterForm.target).find(".form-control");let n=this.opts.filterForm.routeLink;a.length>0&&e.click(function(){callDoActionQuery(n,a)})}},{key:"search",value:function(){var e=this;t(this.opts.searchForm).length>0&&t(document).on("submit",this.opts.searchForm,function(a){t.pjax.submit(a,e.opts.id,e.opts.pjax.pjaxOptions)})}},{key:"pager",value:function(){let e=t(this.opts.pagerDropdown.target),a=this.opts.filterForm.routeLink;e.change(function(t){callDoActionQuery(a,[t.target])})}}]),e}();function n(e){if(e.opts.dateRangeSelector)if("function"!=typeof daterangepicker)console.warn("date range picker option requires https://github.com/dangrossman/bootstrap-daterangepicker.git");else{var a=moment().subtract(29,"days"),n=moment(),i=t(e.opts.dateRangeSelector);i.daterangepicker({startDate:a,endDate:n,ranges:{"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},autoUpdateInput:!1,locale:{format:"YYYY-MM-DD",cancelLabel:"Clear"}}),i.on("apply.daterangepicker",function(e,a){t(this).val(a.startDate.format("YYYY-MM-DD")+" - "+a.endDate.format("YYYY-MM-DD"))}),i.on("cancel.daterangepicker",function(e,a){t(this).val("")})}}_grids.grid={init:function(t){var e=new a(t);e.bindPjax(),e.search(),e.filter(),e.pager()}},_grids.formUtils={showAlert:function(t){void 0!==e&&e.showSuccess("Message",t)},renderAlert:function(e,a){var n=["success","error","notice"],i="";return(void 0===e||t.inArray(e,n)<0)&&(e=n[0]),i+="success"===e?'<div class="alert alert-success">':"error"===e?'<div class="alert alert-danger">':'<div class="alert alert-warning">',i+='<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>',"error"===e?a.serverError?i="<strong>"+(i+=a.serverError.message||"A server error occurred.")+"</strong>":(i="<strong>"+(i+=a.message||"Please fix the following errors")+"</strong>")+this.genarateValidationErrors(a)+"</div>":i+a+"</div>"},genarateValidationErrors:function(t){let e=t.errors||t.validation||{},a=this.getValidationErrors(e);return this.showFormValidationErrors(e),a},getValidationErrors:function(e){var a="";return t.each(e,function(t,e){_.isArray(e)?a+=_.join(_.map(e,function(t){return"<li>"+t+"</li>"}),""):a+="<li>"+e+"</li>"}),a},showFormValidationErrors:function(e){this.clearFormValidationErrors(),t.each(e,function(e,a){let n=t("#modal_form").addClass("was-validated").find('[name="'+e+'"]:visible');if(n.length>0){let e="INPUT"==n[0].tagName?n[0]:n.find("input:visible")[0]||n.find("select")[0];e&&e.setCustomValidity(a),t(n).addClass("is-invalid").next().html(a)}})},clearFormValidationErrors:function(){t("#modal_form").find(".form-control").each(function(e,a){t(a).removeClass("is-invalid").next().html(""),"INPUT"!=a.tagName&&"SELECT"!=a.tagName||a.setCustomValidity("")})},handleFormSubmission:function(e,a,n){var i=t("#"+e),o=i.find(":submit"),r=new FormData(document.getElementById(e)),s=i.find("textarea");if(s&&"undefined"!=typeof CKEDITOR){var l=CKEDITOR.instances[s.attr("name")];if(l){var c=l.getData();r.set(s.attr("name"),c)}}var d=i.attr("action"),u=i.attr("method")||"POST",f=(t(o).html(),i.data("pjax-target")),h=i.data("notification-el")||"modal-notification",m=this;showConfirmMessage(o)&&$api._callApi(u,d,r,_.merge({targetLoading:o,onSuccess:function(e){if(e.success){var n='<i class="fa fa-check"></i> ';n+=e.message,t("#"+h).html(m.renderAlert("success",n)),e.redirectTo?setTimeout(function(){window.location=e.redirectTo},e.redirectTimeout||500):setTimeout(function(){a.modal("hide"),f&&t.pjax.reload({container:f})},500)}else{t(h).html(m.renderAlert("error",e.message)),setTimeout(function(){a.modal("hide")},500)}},onError:function(e){var a=void 0;switch(e.status){case 500:a=m.renderAlert("error",{serverError:{message:"An error occurred on the server."}});break;default:a=m.renderAlert("error",e.responseJSON)}422!=e.status&&t("#"+h).html(a)}},n))}};var i=function(){function e(a){_classCallCheck(this,e);this.options=t.extend({},{},a||{})}return _createClass(e,[{key:"show",value:function(){t(".show_modal_form").on("click",function(e){e.preventDefault();var a=t(this),n=a.html(),i=t("#bootstrap_modal"),o=a.data("modal-size");showConfirmMessage(a)&&(a.attr("disabled","disabled").addClass("disabled").html('<i class="fa fa-spinner fa-spin"></i>&nbsp;loading'),t(".modal-content").load(t(this).attr("href")||t(this).data("href"),function(e,a,n){if("error"==a&&401==n.status){let t=JSON.parse(e);location.href=t.redirect}t("#bootstrap_modal").modal("show"),t(".modal-content").parent("div").addClass("modal-dialog-centered"),o&&t(".modal-content").parent("div").addClass(o)}),i.on("shown.bs.modal",function(e){t(a).html(n).removeAttr("disabled").removeClass("disabled"),_grids.utils.initMultiSelect(t('[data-toggle="multiple"]'))}),i.on("hidden.bs.modal",function(e){t(this).modal("dispose"),t(".modal-content").html("")}))})}}]),e}();t("#bootstrap_modal").off("click",'#modal_form button[type="submit"]').on("click",'#modal_form button[type="submit"]',function(e){e.preventDefault(),_grids.formUtils.handleFormSubmission("modal_form",t("#bootstrap_modal"))}),_grids.modal={init:function(t){new i(t).show()}},_grids.init=function(){if("function"!=typeof daterangepicker)console.warn("date picker option requires https://github.com/dangrossman/bootstrap-daterangepicker.git");else{var e=t(".grid-datepicker");e.daterangepicker({singleDatePicker:!0,showDropdowns:!0,autoUpdateInput:!1,minYear:1901,locale:{format:"YYYY-MM-DD"}}),e.on("apply.daterangepicker",function(e,a){t(this).val(a.startDate.format("YYYY-MM-DD"))}),e.on("cancel.daterangepicker",function(e,a){t(this).val("")})}_grids.modal.init({}),_grids.utils.tableLinks({element:".linkable",navigationDelay:100}),_grids.utils.handleAjaxRequest(t(".data-remote"),"click",{})},t.ajaxSetup({headers:{"X-CSRF-TOKEN":t('meta[name="csrf-token"]').attr("content")}}),t(window).scroll(function(){t(this).scrollTop()>100?(t(".header-logo").css("height","80px"),t(".back-to-top").addClass("active")):(t(".header-logo").css("height",""),t(".back-to-top").removeClass("active"))}),t("#navbarNavDropdown").hasClass("show")||t(".main-content").removeClass("col-md-9"),t(".back-to-top").click(function(){return t("html, body").animate({scrollTop:0},1500),!1}),t("#navbarNavDropdown").on("show.bs.collapse",function(){t(".main-content").addClass("col-md-9")}).on("hidden.bs.collapse",function(){t(this).hasClass("show")||t(".main-content").removeClass("col-md-9")}),t(".btn-download").click(function(e){e.preventDefault(),downloadFilePath(t(this).data("file"))}),_grids.utils.initMultiSelect(t('[data-toggle="multiple"]'))}(jQuery);
